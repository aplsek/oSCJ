oSCJ installation Manual
--------------------------------------
Date: 03/31/2010
Author: Ales Plsek
Version : 1.0

! Please, update the manual whenever something is changed !



1)    SCJ versions:
------------------------------------------------
We have three different versions of SCJ:
1) SCJ running on top of RTSJ (we do not use this one anymore, it was only in the early beginnings of the project )
2) SCJ running on top of FijiVM
3) SCJ running on top of OVM

Because Fiji is not publically available yet, I provide you the instructions how to install SCJ-OVM. 




2)   PROJECT STATUS:
------------------------------------------------
All three version are now runnable, you can test them using either the SCJ HelloWorld example or the miniCDx benchmark.
- installation, compilation and running is done through the Makefile



3)  INSTALLATION:
------------------------------------------------
Installation itself is not difficult, untar the distribution and type "make"

(for this you need to have account on ZED, if you dont have it, you need to wait for the official release of oSCJ)


3.0 Requirements
-----------------

OVM
-----


- needs Java 5 distribution to compile, install Java 5 and modify your PATH to point to your JAVA5

Add to the PATH, for example:
export PATH=opt/jdk1.5.0_22/bin:$PATH



3.1) Checkout development version: SCJ-OVM
----------
Here are the instructions step by step:

1) choose an installation directory, e.g. "scj-ovm/" and cd "scj-ovm/"

2) checkout the following:
$ svn checkout svn+ssh://plsek@zed.cs.purdue.edu/exports/u119/sss/common/svn/ovm/branches/SCJ/OpenVM
$ svn checkout svn+ssh://plsek@zed.cs.purdue.edu/exports/u119/sss/common/svn/scj-project/scj
- just replace my login with yours...

3) Makefile
1) $ copy a "Makefile" from /scj/examples/ovm to "scj-ovm/"
2) modify OVM_HOME and OVM_BUILD variables to have absolute paths to the /scj

4) Java installation
- OVM needs Java5
- before running make, do
$ export PATH=JAVA5_dir/bin:$(PATH)

5) make
- this will compile SCJ, OVM, and helloworld example

6) Helloworld
- helloworld example is placed in scj/examples/helloworld
- type "make run" to run it.


3.3. Downloading an official distribution 
-------------------------

1. Download, untar the distribution into a directory:
e.g. /home/user/oscj


3.3)  DISTRIBUTION DIRECTORY structure
-------------------------------------

#   		oSCJ/	
#        		 OpenVM/       - check out OVM from : svn checkout  svn+ssh://plsek@zed.cs.purdue.edu/exports/u119/sss/common/svn/ovm/branches/SCJ/OpenVM
#         		 doc/ 
#				 Makefile      - put the makefile from /scj/examples/ovm      
#                scj/           - check out from: svn checkout svn+ssh://plsek@zed.cs.purdue.edu/exports/u119/sss/common/svn/scj-project/scj
#				 build/    
#					x86/      -directory generated by OVM, OVM is build here for x86 platform
#					leon3/	- compilation of OVM for leon3
#				 examples/
#					minicdx/     - distribution of the SCJ miniCDx benchmark.
#					helloworld/
#							build/     - contains .class files of the HelloWorld
#           				src/       - helloworld example sources in Java 4!
# 							ovm-config/  - contains configuration file for ovm, so far contains list of classes called by ovm reflectively
#


3.4 OVM and Makefile process
-----------------------------------

3.4.1 info
----------------

SCJ code is copied into OVM dir in: 
/ovm/src/syslib/user/ovm_scj
- the content of this directory is completely updated by the code from scj/ri.

The other SCJ related code is in dirs:
/ovm/src/syslib/user/ovm_classpath 
and
/ovm/src/syslib/user/ovm_platform
- these classes are part of OVM and are not distributed inside SCJ. They were however modified at some places to be compliant with SCJ.

NOTE:
SCJ code is in Java6, however, OVM is able to compile only Java4 code (and to do this, it is dependent on Java5, very tricky!)

Makefile process:
1. SCJ code transformed from J6 - > J4
2. SCJ J4 code copied to /ovm/src/syslib/user/ovm_scj
3. OVM compiled

4. Helloworld is compiled with OVM.
5. helloworld run.

3.4.2  Execute sequence for x86
-----------------------------
	1. make  - OVM, SCJ and Helloworld SCJ are compiled and finally HelloWorld is executed
	2. make cdx - cdx benchmark is executed
	
3.4.3  Execute sequence for LEON3 !!!!!
-----------------------------
	1. make board    - compiles helloworld for board
	2. make board_cdx - compiles cdx for board	

3.5)  SCJ-Fiji
--------------------
The installation procedure for FijiVM is similar, you will just use Makefile from "/examples/fiji" and there is no restriction on Java version.






4.) SOURCE_CODE STRUCTURE:
------------------------------------------------
The SCJ source codes are placed in scj/ri.
For your better orientation, the source code is divided into several categories:
4.1)
ri/spec - contains the core SCJ sources classes defined by the JSR-302 Spec
ri/s3 - contains our SCJ classes needed for our specific implementation of SCJ

4.2) Furthermore, in subdirectories there are some duplicated classes because their implementation differers depending on VM.
fiji - classes specific to fiji
ovm - classes specific to ovm
common - the majority of classes is independent from VM, so they are placed here.
- in scj/ and ovm/ projects are also configuration files for eclipse projects, so you can conveniently open them in Eclipse and you will clearly see the structure I am describing here. 


4.3) The RTSJ based version is in scj/ri_rtsj/




5.) Running your arbitrary application with oSCJ 
----------------------------------------------------------

make app APP=/path/to/your/application/root/directory APP_MAIN="main_class_name_with_package_name"


