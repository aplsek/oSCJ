diff -r 5412de0cf928 bin/fivmc
--- a/bin/fivmc	Thu May 13 19:51:06 2010 -0400
+++ b/bin/fivmc	Thu May 13 22:05:47 2010 -0400
@@ -590,6 +590,8 @@
       puts "                        elimination) late.  The benefits are maginal and so"
       puts "                        this is disabled by default.  Arguments are either"
       puts "                        YES or NO."
+      puts "  --scj-scope-backing   Size of the SCJ wrapper RealtimeThread's scope backing"
+      puts "                        store.  Defaults to 1MB."
       puts "  --g-def-trigger       The default setting for the GC's trigger, in bytes."
       puts "                        This setting can be overridden at runtime with"
       puts "                        FIVMR_GC_TRIGGER.  The default is half of whatever"
@@ -1307,6 +1309,7 @@
                       [ '--sys-ldflags', GetoptLong::REQUIRED_ARGUMENT ],
                       [ '--sys-libs', GetoptLong::REQUIRED_ARGUMENT ],
                       [ '--sys-noinline-attr', GetoptLong::REQUIRED_ARGUMENT ],
+                      [ '--scj-scope-backing', GetoptLong::REQUIRED_ARGUMENT ],
                       [ '--g-def-trigger', GetoptLong::REQUIRED_ARGUMENT ],
                       [ '--g-def-max-mem', GetoptLong::REQUIRED_ARGUMENT ],
                       [ '--g-debug', GetoptLong::NO_ARGUMENT ],
@@ -1490,6 +1493,7 @@
   $debugCflagsEnabled=true
   $scjApplication=nil
   $scjSafelet=nil
+  $scjScopeBacking=1024*1024
   $optCflagsMode=:speed
   $buildType='EXE'
   $linkedPayloads=[]
@@ -1557,6 +1561,8 @@
       $primordialRealtime=true
     when '--scj-safelet'
       $scjSafelet=arg.gsub(/\./,'/')
+    when '--scj-scope-backing'
+      $scjScopeBacking=sizeArg(opt,arg);
     when '--g-def-trigger'
       if $gc and $gc=="NONE"
         $stderr.puts "#{$dollarZero}: warning: --g-def-trigger ignored if you use --gc NONE"
@@ -2963,7 +2969,7 @@
       end
       $main='com/fiji/fivm/SCJMain'
       mysystem "mkdir -p jbuild/com/fiji/fivm"
-      mysystem "#{$java} -cp #{fivmclibs} com.fiji.fivm.util.SCJWrapperGenerator jbuild/com/fiji/fivm/SCJMain.class #{$scjSafelet}"
+      mysystem "#{$java} -cp #{fivmclibs} com.fiji.fivm.util.SCJWrapperGenerator jbuild/com/fiji/fivm/SCJMain.class #{$scjSafelet} #{$scjScopeBacking}"
       mysystem "#{$jar} cf jbuild.jar -C jbuild ."
       otherjars << 'jbuild.jar'
     end
diff -r 5412de0cf928 util/src/com/fiji/fivm/util/SCJWrapperGenerator.java
--- a/util/src/com/fiji/fivm/util/SCJWrapperGenerator.java	Thu May 13 19:51:06 2010 -0400
+++ b/util/src/com/fiji/fivm/util/SCJWrapperGenerator.java	Thu May 13 22:05:47 2010 -0400
@@ -11,9 +11,10 @@
 public class SCJWrapperGenerator {
     public static void main(String[] args)
 	throws FileNotFoundException, IOException {
-	if (args.length != 2) {
-	    System.out.println("SCJWrapper generator requires two arguments: filename classname");
+	if (args.length != 3) {
+	    System.out.println("SCJWrapper generator requires three arguments: filename classname backingsize");
 	}
+	long backingSize = Long.parseLong(args[2]);
 	ClassWriter cw = new ClassWriter(0);
 	cw.visit(Opcodes.V1_5, Opcodes.ACC_PUBLIC, "com/fiji/fivm/SCJMain",
 		 null, "javax/realtime/RealtimeThread", null);
@@ -31,6 +32,13 @@
 	mv = cw.visitMethod(Opcodes.ACC_PUBLIC,
 					  "run", "()V", null, null);
 	mv.visitTypeInsn(Opcodes.NEW, args[1]);
+	mv.visitMethodInsn(Opcodes.INVOKESTATIC,
+			   "java/lang/Thread",
+			   "currentThread", "()Ljava/lang/Thread;");
+	mv.visitLdcInsn(backingSize);
+	mv.visitMethodInsn(Opcodes.INVOKESTATIC,
+			   "edu/purdue/scj/VMSupport",
+			   "setTotalBackingStore", "(Ljava/lang/Thread;J)V");
 	mv.visitInsn(Opcodes.DUP);
 	mv.visitMethodInsn(Opcodes.INVOKESPECIAL,
 			   args[1],
