## -model=MostlyCopyingReflexSplitRegions-B_Mf_F_H selects the mostly copying 
## 	collector with scoped memory support, and the Ovm fast lock
##      implementation.  It must be used in combination with a
##      scope-aware thread manager (such as RealtimeJVM) In addition to
##      the standard mostly-copying options, this collector supports:
##
##      The presence of fast locks may make the performance of
##      synchronized operations harder to reason about.  In
##      particular, a full lock object is allocated the first time
##      that a thread blocks on a monitor, rather than the first time
##      a thread enters one.

##   -immortal-size defines the size of the ImmortalArea (default 4m).
-immortal-size 		"4m"

##   -scope-size defines the size of memory allocated for scopes and other
##   transient memory areas (default: same size as the heap);
-scope-size		heap-size

##   -disable-scope-checks suppresses IllegalAssignmentError and 
## 	MemoryAccessError generation.  Set this flag at your own peril.
-disable-scope-checks	"false"

##   -num-area-kinds specifies the number of VM_Area kinds, default is two
##          for reflexes; using one will effectively disable reflex
##          support and makes MostlyCopyingReflexSplitRegions behave
##          semantically the same as MostlyCopyingSplitRegions
-num-area-kinds "2"

# Add scope support to the context data structure.  
ovm.core.execution.Context$Factory	\
	ovm.core.services.memory.ScopedMemoryContext$Factory

ovm.core.services.memory.MemoryManager						\
 s3.services.memory.mostlyCopying.ReflexSplitRegionManager(heap-size,			\
						     immortal-size,		\
						     scope-size,		\
						     disable-scope-checks,	\
						     num-area-kinds)
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #


# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# Select the object model.  S3Model_B_Mf_F_H uses one word collocated with each
# object to store a blueprint reference, one to track monitor references, one
# to hold a forward address during collection, and one to hold the hash code
# (which can't be derived from the address after an object moves).  This is
# not a pleasingly space-efficient model.  But better ones can be implemented
# with the same functionality.
#
ovm.core.domain.ObjectModel		s3.core.domain.S3Model_B_Mf_F_H
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

ovm.core.services.memory.LocalReferenceIterator			\
	s3.services.memory.conservative.ConservativeLocalReferenceIterator

%include "fast-lock"
